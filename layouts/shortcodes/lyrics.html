{{/* usage:  {{< lyrics id="vituiks_man" >}}  -> data/lyrics/vituiks_man.yml */}}
{{ $id := .Get "id" | lower }}
{{ $song := index site.Data.lyrics $id }}

{{ if not $song }}
  <p style="color:#b91c1c">Data unfound: data/lyrics/{{ $id }}.yml</p>
{{ else }}

{{ $cols := slice }}
{{ $linesMap := dict }}
{{ range $v := $song.language_versions }}
  {{ $cols = $cols | append $v.lang_code }}
  {{ $linesMap = merge $linesMap (dict $v.lang_code $v.lyrics) }}
{{ end }}

{{ $max := 0 }}
{{ range $code := $cols }}
  {{ $l := index $linesMap $code | default (slice) }}
  {{ if gt (len $l) $max }}{{ $max = len $l }}{{ end }}
{{ end }}

<div class="tri-lyrics">
  <h2 class="tri-title">{{ $song.title }}</h2>
  <p class="tri-meta"><strong>{{ $song.artist }}</strong> â€” {{ $song.album }}</p>

  <div class="tri-table-wrap">
    <table class="tri-table">
      <thead>
        <tr>
          {{ range $code := $cols }}
            <th>{{ $code }}</th>
          {{ end }}
        </tr>
      </thead>
      <tbody>
        {{ range $i, $_ := seq $max }}
          <tr>
            {{ range $code := $cols }}
              {{ $arr := index $linesMap $code | default (slice) }}
              <td><span class="line">{{ with index $arr $i }}{{ . }}{{ end }}</span></td>
            {{ end }}
          </tr>
        {{ end }}
      </tbody>
    </table>
  </div>
</div>

<style>
.tri-table-wrap{overflow:auto;border-radius:.5rem}
.tri-table{width:100%;border-collapse:separate;border-spacing:0}
.tri-table th,.tri-table td{border:0;padding:.6rem .8rem;vertical-align:top;line-height:1.6}
.tri-table thead th{font-weight:600;opacity:.85;position:sticky;top:0;background:var(--tri-bg,#fff)}
.tri-table tbody tr:hover td{background:var(--tri-hover,rgba(255,224,130,.35))}
.tri-table tbody td:hover{background:var(--tri-active,rgba(255,224,130,.6))}
.tri-title{margin:.2rem 0 .3rem}
.tri-meta{margin:0 0 .6rem;opacity:.8}
@media (prefers-color-scheme: dark){
  :root{ --tri-bg:#0b0b0b; --tri-hover:rgba(255,255,255,.08); --tri-active:rgba(255,255,255,.14); }
}
</style>
{{ end }}
